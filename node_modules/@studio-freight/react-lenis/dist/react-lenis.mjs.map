{"version":3,"file":"react-lenis.mjs","sources":["../src/index.jsx"],"sourcesContent":["'use client'\n\nimport { useFrame } from '@studio-freight/hamo'\nimport Lenis from '@studio-freight/lenis'\nimport PropTypes from 'prop-types' // ES6\nimport React, {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport { create } from 'zustand'\n\nconst LenisContext = createContext()\n\nconst useRoot = create(() => ({}))\n\nfunction useCurrentLenis() {\n  const local = useContext(LenisContext)\n  const root = useRoot()\n\n  return local ?? root\n}\n\nexport function useLenis(callback = undefined, deps = [], priority = 0) {\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\n\n  useEffect(() => {\n    if (!callback || !addCallback || !removeCallback || !lenis) return\n\n    addCallback(callback, priority)\n    callback(lenis)\n\n    return () => {\n      removeCallback(callback)\n    }\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\n\n  return lenis\n}\n\nconst ReactLenis = forwardRef(({ children, root = false, options = {}, isStopped = false, className }, ref) => {\n  const wrapper = useRef()\n  const content = useRef()\n\n  const [lenis, setLenis] = useState()\n\n  const callbacks = useRef([])\n\n  const addCallback = useCallback((callback, priority) => {\n    callbacks.current.push({ callback, priority })\n    callbacks.current.sort((a, b) => a.priority - b.priority)\n  }, [])\n\n  const removeCallback = useCallback((callback) => {\n    callbacks.current = callbacks.current.filter((cb) => cb.callback !== callback)\n  }, [])\n\n  useImperativeHandle(ref, () => lenis, [lenis])\n\n  useEffect(() => {\n    const lenis = new Lenis({\n      ...options,\n      ...(!root && {\n        wrapper: wrapper.current,\n        content: content.current,\n      }),\n    })\n\n    setLenis(lenis)\n\n    return () => {\n      lenis.destroy()\n      setLenis(undefined)\n    }\n  }, [root, JSON.stringify(options)])\n\n  useFrame((time) => {\n    lenis?.raf(time)\n  })\n\n  useEffect(() => {\n    if (!lenis) return\n    if (isStopped) {\n      lenis.stop()\n    } else {\n      lenis.start()\n    }\n  }, [lenis, isStopped])\n\n  useEffect(() => {\n    if (root && lenis) {\n      useRoot.setState({ lenis, addCallback, removeCallback })\n    }\n  }, [root, lenis, addCallback, removeCallback])\n\n  const onScroll = useCallback((e) => {\n    for (let i = 0; i < callbacks.current.length; i++) {\n      callbacks.current[i].callback(e)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (!lenis) return\n\n    lenis.on('scroll', onScroll)\n\n    return () => {\n      lenis.off('scroll', onScroll)\n    }\n  }, [lenis, onScroll])\n\n  return (\n    <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\n      {root ? (\n        children\n      ) : (\n        <div ref={wrapper} className={className}>\n          <div ref={content}>{children}</div>\n        </div>\n      )}\n    </LenisContext.Provider>\n  )\n})\nReactLenis.displayName = 'ReactLenis'\n\nReactLenis.propTypes = {\n  children: PropTypes.node,\n  root: PropTypes.bool,\n  options: PropTypes.object,\n  isStopped: PropTypes.bool,\n  className: PropTypes.string,\n}\n\nexport { ReactLenis, ReactLenis as Lenis }\n"],"names":["LenisContext","createContext","useRoot","create","useLenis","callback","deps","priority","undefined","local","root","_useCurrentLenis","useContext","lenis","addCallback","removeCallback","useEffect","concat","ReactLenis","forwardRef","_ref","ref","children","_ref$root","_ref$options","options","_ref$isStopped","isStopped","className","wrapper","useRef","content","_useState","useState","setLenis","callbacks","useCallback","current","push","sort","a","b","filter","cb","useImperativeHandle","Lenis","_extends","destroy","JSON","stringify","useFrame","time","raf","stop","start","setState","onScroll","e","i","length","on","off","React","createElement","Provider","value","displayName","propTypes","PropTypes","node","bool","object","string"],"mappings":"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"}