{"version":3,"file":"react-lenis.js","sources":["../src/index.jsx"],"sourcesContent":["'use client'\n\nimport { useFrame } from '@studio-freight/hamo'\nimport Lenis from '@studio-freight/lenis'\nimport PropTypes from 'prop-types' // ES6\nimport React, {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport { create } from 'zustand'\n\nconst LenisContext = createContext()\n\nconst useRoot = create(() => ({}))\n\nfunction useCurrentLenis() {\n  const local = useContext(LenisContext)\n  const root = useRoot()\n\n  return local ?? root\n}\n\nexport function useLenis(callback = undefined, deps = [], priority = 0) {\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\n\n  useEffect(() => {\n    if (!callback || !addCallback || !removeCallback || !lenis) return\n\n    addCallback(callback, priority)\n    callback(lenis)\n\n    return () => {\n      removeCallback(callback)\n    }\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\n\n  return lenis\n}\n\nconst ReactLenis = forwardRef(({ children, root = false, options = {}, isStopped = false, className }, ref) => {\n  const wrapper = useRef()\n  const content = useRef()\n\n  const [lenis, setLenis] = useState()\n\n  const callbacks = useRef([])\n\n  const addCallback = useCallback((callback, priority) => {\n    callbacks.current.push({ callback, priority })\n    callbacks.current.sort((a, b) => a.priority - b.priority)\n  }, [])\n\n  const removeCallback = useCallback((callback) => {\n    callbacks.current = callbacks.current.filter((cb) => cb.callback !== callback)\n  }, [])\n\n  useImperativeHandle(ref, () => lenis, [lenis])\n\n  useEffect(() => {\n    const lenis = new Lenis({\n      ...options,\n      ...(!root && {\n        wrapper: wrapper.current,\n        content: content.current,\n      }),\n    })\n\n    setLenis(lenis)\n\n    return () => {\n      lenis.destroy()\n      setLenis(undefined)\n    }\n  }, [root, JSON.stringify(options)])\n\n  useFrame((time) => {\n    lenis?.raf(time)\n  })\n\n  useEffect(() => {\n    if (!lenis) return\n    if (isStopped) {\n      lenis.stop()\n    } else {\n      lenis.start()\n    }\n  }, [lenis, isStopped])\n\n  useEffect(() => {\n    if (root && lenis) {\n      useRoot.setState({ lenis, addCallback, removeCallback })\n    }\n  }, [root, lenis, addCallback, removeCallback])\n\n  const onScroll = useCallback((e) => {\n    for (let i = 0; i < callbacks.current.length; i++) {\n      callbacks.current[i].callback(e)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (!lenis) return\n\n    lenis.on('scroll', onScroll)\n\n    return () => {\n      lenis.off('scroll', onScroll)\n    }\n  }, [lenis, onScroll])\n\n  return (\n    <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\n      {root ? (\n        children\n      ) : (\n        <div ref={wrapper} className={className}>\n          <div ref={content}>{children}</div>\n        </div>\n      )}\n    </LenisContext.Provider>\n  )\n})\nReactLenis.displayName = 'ReactLenis'\n\nReactLenis.propTypes = {\n  children: PropTypes.node,\n  root: PropTypes.bool,\n  options: PropTypes.object,\n  isStopped: PropTypes.bool,\n  className: PropTypes.string,\n}\n\nexport { ReactLenis, ReactLenis as Lenis }\n"],"names":["LenisContext","createContext","useRoot","create","ReactLenis","forwardRef","_ref","ref","children","_ref$root","root","_ref$options","options","_ref$isStopped","isStopped","className","wrapper","useRef","content","_useState","useState","lenis","setLenis","callbacks","addCallback","useCallback","callback","priority","current","push","sort","a","b","removeCallback","filter","cb","useImperativeHandle","useEffect","Lenis","_extends","destroy","undefined","JSON","stringify","useFrame","time","raf","stop","start","setState","onScroll","e","i","length","on","off","React","createElement","Provider","value","displayName","propTypes","PropTypes","node","bool","object","string","deps","local","_useCurrentLenis","useContext","concat"],"mappings":"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"}