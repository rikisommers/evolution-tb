{"version":3,"file":"react-lenis.modern.mjs","sources":["../src/index.jsx"],"sourcesContent":["'use client'\n\nimport { useFrame } from '@studio-freight/hamo'\nimport Lenis from '@studio-freight/lenis'\nimport PropTypes from 'prop-types' // ES6\nimport React, {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport { create } from 'zustand'\n\nconst LenisContext = createContext()\n\nconst useRoot = create(() => ({}))\n\nfunction useCurrentLenis() {\n  const local = useContext(LenisContext)\n  const root = useRoot()\n\n  return local ?? root\n}\n\nexport function useLenis(callback = undefined, deps = [], priority = 0) {\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\n\n  useEffect(() => {\n    if (!callback || !addCallback || !removeCallback || !lenis) return\n\n    addCallback(callback, priority)\n    callback(lenis)\n\n    return () => {\n      removeCallback(callback)\n    }\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\n\n  return lenis\n}\n\nconst ReactLenis = forwardRef(({ children, root = false, options = {}, isStopped = false, className }, ref) => {\n  const wrapper = useRef()\n  const content = useRef()\n\n  const [lenis, setLenis] = useState()\n\n  const callbacks = useRef([])\n\n  const addCallback = useCallback((callback, priority) => {\n    callbacks.current.push({ callback, priority })\n    callbacks.current.sort((a, b) => a.priority - b.priority)\n  }, [])\n\n  const removeCallback = useCallback((callback) => {\n    callbacks.current = callbacks.current.filter((cb) => cb.callback !== callback)\n  }, [])\n\n  useImperativeHandle(ref, () => lenis, [lenis])\n\n  useEffect(() => {\n    const lenis = new Lenis({\n      ...options,\n      ...(!root && {\n        wrapper: wrapper.current,\n        content: content.current,\n      }),\n    })\n\n    setLenis(lenis)\n\n    return () => {\n      lenis.destroy()\n      setLenis(undefined)\n    }\n  }, [root, JSON.stringify(options)])\n\n  useFrame((time) => {\n    lenis?.raf(time)\n  })\n\n  useEffect(() => {\n    if (!lenis) return\n    if (isStopped) {\n      lenis.stop()\n    } else {\n      lenis.start()\n    }\n  }, [lenis, isStopped])\n\n  useEffect(() => {\n    if (root && lenis) {\n      useRoot.setState({ lenis, addCallback, removeCallback })\n    }\n  }, [root, lenis, addCallback, removeCallback])\n\n  const onScroll = useCallback((e) => {\n    for (let i = 0; i < callbacks.current.length; i++) {\n      callbacks.current[i].callback(e)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (!lenis) return\n\n    lenis.on('scroll', onScroll)\n\n    return () => {\n      lenis.off('scroll', onScroll)\n    }\n  }, [lenis, onScroll])\n\n  return (\n    <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\n      {root ? (\n        children\n      ) : (\n        <div ref={wrapper} className={className}>\n          <div ref={content}>{children}</div>\n        </div>\n      )}\n    </LenisContext.Provider>\n  )\n})\nReactLenis.displayName = 'ReactLenis'\n\nReactLenis.propTypes = {\n  children: PropTypes.node,\n  root: PropTypes.bool,\n  options: PropTypes.object,\n  isStopped: PropTypes.bool,\n  className: PropTypes.string,\n}\n\nexport { ReactLenis, ReactLenis as Lenis }\n"],"names":["LenisContext","createContext","useRoot","create","useLenis","callback","undefined","deps","priority","lenis","addCallback","removeCallback","local","useContext","root","useCurrentLenis","useEffect","ReactLenis","forwardRef","children","options","isStopped","className","ref","wrapper","useRef","content","setLenis","useState","callbacks","useCallback","current","push","sort","a","b","filter","cb","useImperativeHandle","Lenis","_extends","destroy","JSON","stringify","useFrame","time","raf","stop","start","setState","onScroll","e","i","length","on","off","React","createElement","Provider","value","displayName","propTypes","PropTypes","node","bool","object","string"],"mappings":"ghBAiBA,MAAMA,EAAeC,IAEfC,EAAUC,EAAO,KAAO,CAAE,IASzB,SAASC,EAASC,OAAWC,EAAWC,EAAO,GAAIC,EAAW,GACnE,MAAMC,MAAEA,EAAKC,YAAEA,EAAWC,eAAEA,GAR9B,WACE,MAAMC,EAAQC,EAAWb,GACnBc,EAAOZ,IAEb,OAAY,MAALU,EAAAA,EAASE,CAClB,CAGiDC,GAa/C,OAXAC,EAAU,KACR,GAAKX,GAAaK,GAAgBC,GAAmBF,EAKrD,OAHAC,EAAYL,EAAUG,GACtBH,EAASI,GAEF,KACLE,EAAeN,EAAQ,CACzB,EACC,CAACI,EAAOC,EAAaC,EAAgBH,KAAaD,IAE9CE,CACT,CAEM,MAAAQ,EAAaC,EAAW,EAAGC,WAAUL,KAAAA,GAAO,EAAOM,QAAAA,EAAU,GAAIC,UAAAA,GAAY,EAAOC,aAAaC,KACrG,MAAMC,EAAUC,IACVC,EAAUD,KAEThB,EAAOkB,GAAYC,IAEpBC,EAAYJ,EAAO,IAEnBf,EAAcoB,EAAY,CAACzB,EAAUG,KACzCqB,EAAUE,QAAQC,KAAK,CAAE3B,WAAUG,aACnCqB,EAAUE,QAAQE,KAAK,CAACC,EAAGC,IAAMD,EAAE1B,SAAW2B,EAAE3B,SAClD,EAAG,IAEGG,EAAiBmB,EAAazB,IAClCwB,EAAUE,QAAUF,EAAUE,QAAQK,OAAQC,GAAOA,EAAGhC,WAAaA,IACpE,IAEHiC,EAAoBf,EAAK,IAAMd,EAAO,CAACA,IAEvCO,EAAU,KACR,MAAMP,EAAQ,IAAI8B,EAAKC,EAClBpB,CAAAA,EAAAA,GACEN,GAAQ,CACXU,QAASA,EAAQO,QACjBL,QAASA,EAAQK,WAMrB,OAFAJ,EAASlB,GAEF,KACLA,EAAMgC,UACNd,OAASrB,EACX,CAAA,EACC,CAACQ,EAAM4B,KAAKC,UAAUvB,KAEzBwB,EAAUC,IACRpC,MAAAA,GAAAA,EAAOqC,IAAID,KAGb7B,EAAU,KACHP,IACDY,EACFZ,EAAMsC,OAENtC,EAAMuC,QACR,EACC,CAACvC,EAAOY,IAEXL,EAAU,KACJF,GAAQL,GACVP,EAAQ+C,SAAS,CAAExC,QAAOC,cAAaC,kBACzC,EACC,CAACG,EAAML,EAAOC,EAAaC,IAE9B,MAAMuC,EAAWpB,EAAaqB,IAC5B,IAAK,IAAIC,EAAI,EAAGA,EAAIvB,EAAUE,QAAQsB,OAAQD,IAC5CvB,EAAUE,QAAQqB,GAAG/C,SAAS8C,EAChC,EACC,IAYH,OAVAnC,EAAU,KACR,GAAKP,EAIL,OAFAA,EAAM6C,GAAG,SAAUJ,GAEZ,KACLzC,EAAM8C,IAAI,SAAUL,EAAQ,CAC9B,EACC,CAACzC,EAAOyC,iBAGTM,EAAAC,cAACzD,EAAa0D,SAASC,CAAAA,MAAO,CAAElD,QAAOC,cAAaC,mBACjDG,EACCK,eAEAqC,EAAAC,cAAKlC,MAAAA,CAAAA,IAAKC,EAASF,UAAWA,gBAC5BkC,EAAAC,cAAA,MAAA,CAAKlC,IAAKG,GAAUP,IAGH,GAG3BF,EAAW2C,YAAc,aAEzB3C,EAAW4C,UAAY,CACrB1C,SAAU2C,EAAUC,KACpBjD,KAAMgD,EAAUE,KAChB5C,QAAS0C,EAAUG,OACnB5C,UAAWyC,EAAUE,KACrB1C,UAAWwC,EAAUI"}